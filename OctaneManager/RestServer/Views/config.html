<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>TFS plugin for ALM Octane</title>
	<meta name="description" content="TFS plugin for ALM Octane">
	<meta name="author" content="Microfocus">

	<style>

body{
	padding :0;
	margin :0;
    font-family: MetricWeb-Medium,Calibri,sans-serif;
}
#header{
	background-color: #0079ef;
    height: 60px;
    color: white;
}

#octanelogo{
	float: left;
	height: 60px;
	width: 60px;
}
#title{
    padding: 15px 15px 15px 80px;
	line-height : 24px;
	font-weight: bold;
	font-size: 24px;
}

input[type=text], input[type=password]  {

	border: 1px solid #ccc;
    border-radius: 4px;
	padding: 5px;
    margin: 1px;
	width:800px;
	font-size: 17px;
}

button {

	float: right;
    width: 250px;
    background-color: #0079ef;
    color: white;
    border: none;
    height: 30px;
    margin: 10px 0;
	border-radius: 4px;
	font-size: 17px;
}

button:hover{
 background-color: #009fef;
 font-weight: bold;
}


button:active {
  transform: translateY(1px);
  background-color: #009fef;
  font-weight: bold;
}

table{
	margin : 18px 0 0 20px;
	font-size: 17px;
}
table .itemCaption{
	padding:10px 10px 20px 0;

}

#testConnectionMessage{
	float: left;
    width: 500px;
    margin: 10px 0 0 0;
}
</style>

	<noscript>Sorry, your browser does not support JavaScript!</noscript>
</head>


<body>

	<div id="header">
		<img id="octanelogo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAyCAIAAACVqM/bAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAP/SURBVFhH7Vd9TI1hFGfmD4zNho2xMTPzB5sZZuMPmU3zVSiqMWYkWluXucKlFFJ0XSlKKmpCRYhrPkofdvOVuLpZtXItKpU+qFjs+nXP7fHuuff2vvf22vxxz35/PM95z3Oe3/s+5zznvIMGuyn+K7gIicFFSAwuQmJwERKDPIRmbI7UPq8AMOAeOYqBEpq5NerE1bzPze0ms9S3dERdzZu1NZozkw7nCY3xUAXH5ZRW1REVobyuqtsdf2vcmkPcEilwktCGI5fvlhgs+9sRnKDf0XRuoSgcJjRt47HMgjeWPQVSYWwELBOB3NGVYwnnpB84QGjk8pDwtAfdP3ssW5lMaQ9fVtU10dhdmbh0z3kaN7V9P3f7ac+v3zTFIPpa/uhVBziHNiGV0JYTGQhY2gCiK/+wIFDjFZpKU5wOmd0s1pMm5EIupR5NIVi+7eS1oUv3MJ82IU5o7eEUtg2kxGAM1GSPWhEy2Sf8SVk1NEgxfBsydlPEf/zSCqXB2DA3QD1kye7NkRmPXlWal/ZKrs6A+GPOrSFOqLa+hXwZG79GpD+cvuk46VXJWtIj7ZkxABvSa7ILSTPROwwfrPxDA+lbv3UxY2tIJYRYEcbm+HWHv3X9gB7hwgUHQo0OF6GDj8T0WEJRD4dMaQ2phHC1CJVnc4qhhCjic4R6wi5NNj29/qRsuLuS6eno5flCQkIequT2zm4o7z2rGOupYnoGfKTswre9jEwm/5jrTP9PCI1w35dlvodwIr4RacyMg2cf6SJ9zVS/o6T8J4R2xGRiCknWPmM2NhF7s4gsQ1Pvk0Z+QnjXYn0NpsjtxcFxQjNrzAtQI/lhXP2peWFQLDRyEsovq8YY74ox5PiVx0Ibe0C2k31GXimmcIIxHAptODhAaNL6MKobyGqJdQD3Mqsti4JiZSaEymX2bEIF4Gz6AWocrXrx/qOchHABmt32+hWtRxxYRaNyKw8hEhyZd9glzkAUqHSf+lpKiDxBTZKYq+OeSgSSwOJCRkL44Ej1Kb4RTmD29lPgQX7kPDJZRM4jk0UGSgh5yzXLmOKGlAh9Tb1lmVnweugzuS2EECcEIM8D1Fks8yFoYYW9jk0gbujiIUH/hJ5u2LK9nBkHSYQI+P1Dr97w1dJZt33vRvlEweLMgDn+MeqsgpaOTqHl/J2nOTObcIAQYZkyIf3RK9oJgvKJgoUmlZ5O8ApVJtx5V/v3mPDPtPrgRbZcFA4TIqzcn8SKFARjhBoXbQgXn3C7DZM9OEkIQK3dn3TX5s9hZV3ToRQtrh9uiRQ4T4iAGDpzowhRQlTQJaLdxi8bZyYdAyVEQMahVQVEU08U8hCSES5CYnAREoOLkBhchPqHm+IP5+URxCduZkAAAAAASUVORK5CYII=" alt="octane.png">
		<div id="title">TFS Plugin for ALM Octane - Configuration</div>

	</div>


	<table>
		<tr><td class="itemCaption">ALM Octane Location</td><td><div><input type="text" name="octaneLocation" title="Location of the HPE ALM Octane application. You can copy the URL from the address bar of the browser in which you opened ALM Octane."></div></td></tr>
		<tr><td class="itemCaption">ALM Octane Client ID</td><td><input type="text" name="octaneClientId" title="Client ID used for logging into the ALM Octane server. Obtain a Client ID and Client secret from ALM Octane configuration."></td></tr>
		<tr><td class="itemCaption">ALM Octane Client Secret</td><td><input type="password" name="octaneClientSecret" title="Client secret used for logging into the ALM Octane server"></td></tr>
		<tr><td class="itemCaption">Tfs Location</td><td><input type="text" name="tfsLocation" title="HTTP address of the TFS, such as http://yourhost:8080/tfs/. This value is used to let plugin know how to refer to itself, for example to create links to build/run/etc. This is necessary because plugin cannot reliably detect such a URL from within itself."></td></tr>
		<tr><td class="itemCaption">Tfs PAT</td><td><input type="password" name="tfsPat" title="Personal Acess Token To TFS."></td></tr>
		<tr><td class="itemCaption">Instance Id</td><td><input type="text" name="instanceId" title="An ID to uniquely identify this instance of the plugin."></td></tr>
		<tr><td></td><td><div><p id="resultMessage"></p><button id="testConnection" type="button">Test Connection</button></div></td></tr>
		<tr><td></td><td><div><button id="saveButton" type="button">Save</button></div></td></tr>
	</table>

</body>

<script src="resources/jquery-3.2.1.min.js"></script>


<script>
$(document).ready(function(){
	//{defaultConf}

	if(defaultConf){
		$("input[name='octaneLocation']").val(defaultConf.ALMOctaneUrl);
		$("input[name='octaneClientId']").val(defaultConf.ClientId);
		$("input[name='octaneClientSecret']").val(defaultConf.ClientSecret);
		$("input[name='tfsLocation']").val(defaultConf.TfsLocation);
		$("input[name='tfsPat']").val(defaultConf.Pat);
		$("input[name='instanceId']").val(defaultConf.InstanceId);
	}

	registerForButtonClick("#testConnection","/config/test","Validating...","Configuratin validated successfully");
	registerForButtonClick("#saveButton","/config","Saving...","Configuration saved successfully");
	
	function registerForButtonClick(buttonName, postUrl, processMessage, successMessage){

		$(buttonName).click(function(){
			$("#resultMessage").css('color', '#0079ef');
			$("#resultMessage").text(processMessage);
			var confObj = {
				"ALMOctaneUrl": $("input[name='octaneLocation']").val(),
				"ClientId": $("input[name='octaneClientId']").val(),
				"ClientSecret": $("input[name='octaneClientSecret']").val(),
				"TfsLocation": $("input[name='tfsLocation']").val(),
				"Pat": $("input[name='tfsPat']").val(),
				"InstanceId": $("input[name='instanceId']").val()
			};
			var confJson = JSON.stringify(confObj);
			$(buttonName).prop('disabled', true);
			var jqxhr = $.post(postUrl, confJson, function(a,b) {
				//alert( "success" );
				$("#resultMessage").css('color', 'green');
				$("#resultMessage").text(successMessage);
			})
			  .fail(function(err) {
				//alert( err.responseText );
				$("#resultMessage").css('color', 'red');
				var errMsg = err.responseText;
				var maxLength = 100;
				if(errMsg.length > maxLength){
					errMsg = errMsg.substr(0, maxLength-3) + "...";
				}
				$("#resultMessage").text(errMsg);
			  }).always(function() {
				$(buttonName).prop('disabled', false);
			});
		});
	}
	
});
</script>
</html>
